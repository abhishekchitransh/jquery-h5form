// jQuery.h5form -laster by Author: Yoshiyuki Mikome http://www.rapidexp.com/h5form
(function(a){a.fn.h5form=function(f){a.fn.outerHTML=function(){var F=a(this).get(0);return F.outerHTML||new XMLSerializer().serializeToString(F)};var o={classResponse:"h5form-response",colorErr:"mistyrose",emptyMessage:"このフィールドを入力してください。",unselectedMessage:"リスト内の項目を選択してください。",patternMessage:"必用なパターンに一致していません。",emailMessage:"メールアドレスが正しくありません。",urlMessage:"URLが正しくありません。",colorOff:"#a1a1a1",maxlengthMessage:"指定の文字数上限より # 文字多いです。",invalidMessage:"値が無効です。",minMessage:"# 以上にしてください。",maxMessage:"# 以下にしてください。",classSpinNumber:"h5form-spinNumber",classRange:"h5form-range",classSpinTime:"h5form-spinTime",classDatetime:"h5form-datetime",dynamicHtml:false};var r=a.extend({},o,f);var i=parseInt(a.browser.version),y=a("<input>").hide().appendTo(a("body")).get(0),x=a("textarea:first").get(0)||new Object(),z=("setCustomValidity" in y),C=(a.browser.webkit&&i>=533),t=("autofocus" in y),B=("required" in y),E=("pattern" in y),g=hasUrl=z&&E,b=("placeholder" in y),s=hasRange=("step" in y)&&("min" in y),A=(a.browser.opera&&i>9),u=("maxLength" in x),p=("form" in y)&&("formAction" in y),d=!(a.browser.msie&&i<9);a("input:last").remove();a("body").click(function(){a("."+r.classResponse).remove()});return this.each(function(){var K=a(this),J,L=new Array(),H=new Object(),G=":input:enabled:not(:button, :submit, :radio, :checkbox)",I=K.find(G),F=!!K.outerHTML().match(/^[^>]+ novalidate/);a.fn.setCustomValidity=function(M,O){if(F){O=null}var P=a(this);if(P.is(G)){if(!C&&O&&(title=P.getAttr("title"))){O+="\n"+title}if(z){P.get(0).setCustomValidity(O)}else{var N=P.get(0).uniqueNumber;if(O){M[N]=new Array(P,O.replace(/\n/,"<br />"));P.css("backgroundColor",r.colorErr)}else{M[N]=null;P.css("backgroundColor","")}}}return P};a.fn.spin=function(N){var S=a(this),O=(S.getAttr("type").toLowerCase()=="number"),P=j(S,"min",(O)?"":0),M=j(S,"max",(O)?"":86400),Q=j(S,"step",(O)?1:60),R=(O)?P:0,T=(O)?Number(S.val()):q(S.val(),true);T=T-((T-R)%Q)+Q*((N)?-1:1);if(M!=""&&T>M){T=M}if(P!=""&&T<P){T=P}S.val((O)?T:w(T,Q%60,true));return S};a.fn.getAttr=function(N){var M=a(this).attr(N);return(M==undefined)?"":M};a.fn.initControl=function(){return this.each(function(){var Z=a(this),X=Z.getAttr("type").toLowerCase();if(!t&&!J&&Z.getAttr("autofocus")){J=Z}var aa=Z.getAttr("placeholder");if(!b&&aa&&X!="password"){L.push(Z);var ab=(function(){if(Z.val()==aa){Z.attr("value","").css("color","")}});Z.unbind("focus",ab).focus(ab);var Q=(function(){if(Z.val()==""||Z.val()==aa){Z.val(aa).css("color",r.colorOff)}});Z.unbind("blur",Q).blur(Q).blur()}if(false||(!s&&X=="number")||(!A&&X=="time")){var V,M;switch(X){case"number":V=r.classSpinNumber;M=[8,9,35,36,37,39,46,190];break;default:V=r.classSpinTime;M=[8,9,35,36,37,39,46,59,186,190];break}var U=(function(ac){var ad=ac.charCode||ac.keyCode;if(ad==38){Z.spin(0)}if(ad==40){Z.spin(1)}if((a.inArray(ad,M)>=0)||(ad>=48&&ad<=57)){return true}return false});Z.unbind("keydown",U).keydown(U).after('<span class="'+V+'"><button type="button">&and;</button><button type="button">&or;</button></span>');Z.next().children().click(function(){Z.spin(Z.next().children().index(a(this))).change()})}if(!A&&(X=="date")&&("datepicker" in Z)){var T={dateFormat:"yy-mm-dd"};T.minDate=Z.getAttr("min");T.maxDate=Z.getAttr("max");Z.datepicker(T)}if(!hasRange&&(X=="range")&&("slider" in Z)){var R=j(Z,"min",0),Y=j(Z,"max",100),O=j(Z,"step",1),N=j(Z,"val",(R+Y)/2-((R+Y)/2%O));Z.hide().after('<span class="'+r.classRange+'"><div></div></span>').val(N);Z.next().children().slider({min:R,max:Y,step:O,value:N,change:function(ad,ac){Z.val(a(this).slider("value"))}})}if(!u&&Z.is("textarea")&&(maxlength=Z.getAttr("maxlength"))){var S=(function(ac){var ad=ac.charCode||ac.keyCode;if((a.inArray(ad,[8,9,37,39,46])<0)&&(this.value.length>=maxlength)){return false}return true});Z.unbind("keypress",S).keypress(S)}if(!A&&(X=="datetime"||X=="datetime-local")){if(!Z.next().hasClass(r.classDatetime)){var N=n(Z.val()),R=n(Z.getAttr("min")),Y=n(Z.getAttr("max")),P=(X=="datetime")?'<span class="h5form-timezone">'+m()+"</span>":"";Z.hide().after('<span class="'+r.classDatetime+'"><input type="date" value="'+N[0]+'" min="'+R[0]+'" max="'+Y[0]+'" size="'+Z.getAttr("size")+'" class="'+Z.getAttr("class")+'" title="'+Z.getAttr("title")+'"><input type="time" value="'+N[1]+'" step="'+j(Z,"step",60)+'" size="'+Z.getAttr("size")+'" class="'+Z.getAttr("class")+'" title="'+Z.getAttr("title")+'">'+P+"</span>");if(Z.getAttr("required")){Z.removeAttr("required");Z.next().children().attr("required","required").initControl()}else{Z.next().children().initControl()}}}var W=(function(){var ai=false,ak=((Z.val()=="")||(aa&&Z.val()==aa));Z.setCustomValidity(H,null);if(!B&&Z.getAttr("required")){ai=true;if(ak){Z.setCustomValidity(H,(Z.is("select"))?r.unselectedMessage:r.emptyMessage);return true}}if(!E&&(an=Z.getAttr("pattern"))){ai=true;if(!ak&&v(Z,"^("+an.replace(/^\^?(.*)\$?$/,"$1")+")$")){Z.setCustomValidity(H,r.patternMessage);return true}}if(!g&&X=="email"){ai=true;if(!ak&&v(Z,"[\\w-\\.]{3,}@([\\w-]{2,}\\.)*([\\w-]{2,}\\.)[\\w-]{2,4}","i")){Z.setCustomValidity(H,r.emailMessage);return true}}if(!hasUrl&&X=="url"){ai=true;if(!ak&&v(Z,"[\\w-\\.]{3,}:\\/\\/([\\w-]{2,}\\.)*([\\w-]{2,}\\.)[\\w-]{2,4}","i")){Z.setCustomValidity(H,r.urlMessage);return true}}if(!u&&Z.is("textarea")&&Z.getAttr("maxlength")){ai=true;if(over=k(Z)){Z.setCustomValidity(H,r.maxlengthMessage.replace(/#/,over));return true}}if(false||(!s&&X=="number")||(!A&&(X=="date"||X=="time"))){ai=true;var ap=Z,am=X,ao=Z;if(Z.parent().hasClass(r.classDatetime)){ap=Z.parent().prev();am=ap.getAttr("type").toLowerCase();ao=Z.parent().children("input");ao.setCustomValidity(H,"");var al=ao.index(Z),ah=ao.eq(0).val(),ag=ao.eq(1).val();if(ah!=""||ag!=""){if(ah==""||ag==""){var aj=n(ap.getAttr("min"),true);if(al==0&&ah!=""&&ag==""){ao.eq(1).val(aj[1])}if(al==1&&ag!=""&&ah==""){ao.eq(0).val(aj[0])}ah=ao.eq(0).val(),ag=ao.eq(1).val()}var af=a.trim(ah+"T"+ag);if(am=="datetime-local"){ap.val(af)}else{var ad=h(af);ap.val(ad[0]+"T"+ad[1])}}else{ap.val("")}}var an="^-?\\d+\\.?\\d*$",aj=0,ae=1;switch(am){case"date":an="^\\d+-\\d+-\\d+$";aj="1970-01-01";ae=1;break;case"time":an="^\\d+:\\d+:?\\d*\\.?\\d*$";aj="00:00";ae=60;break;case"datetime":an="^\\d+-\\d+-\\d+T\\d+:\\d+:?\\d*\\.?\\d*Z$";aj="1970-01-01T00:00";ae=60;break;case"datetime-local":an="^\\d+-\\d+-\\d+T\\d+:\\d+:?\\d*\\.?\\d*$";aj="1970-01-01T00:00";ae=60;break}if(v(ap,an)||(l(ap,aj,ae))){ao.setCustomValidity(H,r.invalidMessage);return true}if(c(ap)){ao.setCustomValidity(H,r.minMessage.replace(/#/,ap.getAttr("min")));return true}if(e(ap)){ao.setCustomValidity(H,r.maxMessage.replace(/#/,ap.getAttr("max")));return true}}if(!d&&!Z.is("select, textarea, button")){var ac=(function(aq){var ar=aq.charCode||aq.keyCode;if(ar==13){K.find("input:submit, button:submit").eq(0).click();return false}return true});Z.unbind("keypress",ac).keypress(ac);ai=true}return ai});if(W()){Z.unbind("change",W).change(W)}})};I.initControl();if(J){J.focus().select()}K.find("input:submit, input:image, input:button, button:submit").click(function(){if(!ev.result){return false}var Q=a(this);if(!p){if(attr=Q.getAttr("formaction")){K.attr("action",attr)}if(attr=Q.getAttr("formeenctype")){K.attr("enctype",attr)}if(attr=Q.getAttr("formmethod")){K.attr("method",attr)}if(attr=Q.getAttr("formtarget")){K.attr("target",attr)}if(attr=Q.getAttr("formnovalidate")){K.attr("novalidate",attr);if(attr=="novalidate"){I.each(function(){a(this).setCustomValidity(H,"")})}}}if(r.dynamicHtml){K.find(r.dynamicHtml).initControl()}if(!z){var N;for(var M in H){if(H[M]&&(N==null||N>M)){N=M}}if(N!=null){var P=H[N][0],O=H[N][1];P=P.eq(0);if(!P.prev().hasClass(r.classResponse)){P.before('<span class="'+r.classResponse+'"></span>')}P.prev().html("<p>"+O.replace(/\n/,"<br/>")+"</p>");P.focus().select();return false}}if(!b){for(var N in L){if(N!=undefined){var R=L[N];if(R.val()==R.getAttr("placeholder")){R.val("")}}}}if(!d){a('<input type="hidden" name="'+Q.getAttr("name")+'" value="'+Q.val()+'">').appendTo(K);K.find("button, input:submit").attr("name","");if(Q.is("button")){K.find("input:submit").remove()}}})});function v(G,H,F){re=new RegExp(H,F);return((G.val()!="")&&G.val().search(re))}function l(H,F,G){F=(H.getAttr("type").toLowerCase().indexOf("datetime"))?j(H,"min",F):j(H,"",F);G=j(H,"step",G);var I=j(H,"val","");return((I!="")&&((I-F)%G))}function c(G){var H=j(G,"val",""),F=j(G,"min","");return((H!="")&&(F!="")&&(H<F))}function e(G){var H=j(G,"val",""),F=j(G,"max","");return((H!="")&&(F!="")&&(H>F))}function k(H){var G=H.val().length,F=j(H,"maxlength",0);return(G&&F&&(G>F))?G-F:0}function j(G,F,H){var I=(F)?((F=="val")?G.val():G.getAttr(F)):H;if(I==undefined||I==""){I=""+H}if(I.match(/\d+-\d+-\d+[ T]\d+:\d/)){return Date.parse(D(I))/(1000)}if(I.match(/\d+-\d+-\d+/)){return Date.parse(D(I))/(1000*60*60*24)}if(I.match(/\d+:\d/)){return q(I,true)}return Number(I)}function q(G,F){if(G.search(/\d+:\d+/)){G="00:00"}if(F){G+=" GMT"}return Date.parse("1970/1/1 "+G)/1000}function w(I,G,H){var F=new Date(I*1000);ret=(H)?F.toUTCString():toString();return ret.replace((G)?/.* (\d+:\d+:\d+).*$/:/.* (\d+:\d+).*$/,"$1")}function n(J,F){if(!J&&!F){return new Array("","")}var H=(!J)?new Date():new Date(D(J)),G=H.getFullYear()+"-"+(H.getMonth()+1)+"-"+H.getDate();G=G.replace(/\b(\d)\b/g,"0$1");var I=(J)?H.toString().replace(/.* (\d+:\d+:\d+).*$/,"$1"):"12:00";return new Array(G,I)}function h(I){var G=new Date(D(I)),F=G.getUTCFullYear()+"-"+(G.getUTCMonth()+1)+"-"+G.getUTCDate();F=F.replace(/\b(\d)\b/g,"0$1");var H=G.toUTCString().replace(/.* (\d+:\d+:\d+).*$/,"$1Z");return new Array(F,H)}function D(F){return F.replace(/-/g,"/").replace(/T/," ").replace(/Z/," GMT").replace(/([+-])(\d+):(\d+)/," GMT$1$2$3")}function m(){var H=new Date(),G=-1*H.getTimezoneOffset();if(G){var F=G/60+":"+G%60;return F.replace(/\b(\d)\b/g,"0$1").replace(/^(\d)/,"+$1")}else{return"UTC"}}}})(jQuery);